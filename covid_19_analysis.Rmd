---
title: "covid_19_analysis"
author: "Benji Edwards"
date: "`r Sys.Date()`"
output: github_document
---
Is state an indicator for COVID deaths?

# Import
Load R packages and data from Johns Hopkins COVID-19 repository. This data includes case reports from January 21, 2020 to March 10, 2023.
```{r Import}
# Load in R packages and data
library(tidyverse)

us_covid_cases <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv")

us_covid_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv")

```
#Inspect
Let's take a look at the data that we've imported.
```{r Inspect}

# US COVID cases
nrow(us_covid_cases)
head(us_covid_cases)
tail(us_covid_cases)
# US COVID deaths
nrow(us_covid_deaths)
head(us_covid_deaths)
tail(us_covid_deaths)
```

# Tidy
Now let's tidy the data so it can be analyzed. I want to summarize all of the cases and deaths by county. Upon further inspection of my data, it looks like we've got a running sum of cases and deaths by the date columns. Keep the last date column will give me my totals for each county.
```{r Tidy cases}
# Let's start by dropping all the columns we don't need 
us_cases_clean <- us_covid_cases %>%
  select(-c('Lat', 'Long_', 'UID', 'iso2', 'iso3', 'code3', 'FIPS', 'Country_Region', 'Combined_Key'))

# Now pivot on the county and state columns
us_cases_clean <-  us_cases_clean %>%
  pivot_longer(cols = -c('Admin2', 'Province_State'),
               names_to = "date",
               values_to = "cases")

us_cases_clean <- us_cases_clean %>%
  filter(!grepl("Population", date))

# Finally, let's group by county
us_county_cases <- us_cases_clean %>%
  group_by(Admin2, Province_State) %>%
  summarise(cases = sum(cases))

us_county_cases

```

Let's repeat this for 'us_covid_deaths'
```{r Tidy deaths}
# Remove unwanted columns
us_deaths_clean <- us_covid_deaths %>%
  select(-c('Lat', 'Long_', 'UID', 'iso2', 'iso3', 'code3', 'FIPS', 'Country_Region', 'Combined_Key'))

# Pivot by county and state
us_deaths_clean <-  us_deaths_clean %>%
  pivot_longer(cols = -c('Admin2', 'Province_State'),
               names_to = "date",
               values_to = "deaths")
# Inspect data
us_deaths_clean

# I found the word "Population" in my date columns. Let's drop any rows with "Population".

us_deaths_clean <- us_deaths_clean %>%
  filter(!grepl("Population", date))

# Inspect data
us_deaths_clean


```
Excellent! It looks like our two dataframes have the same number of rows. Looks like we're ready to merge them together.
``` {r Merge data}
us_covid <- merge(us_cases_clean, us_deaths_clean, by = c("Admin2", "Province_State"))
us_covid
```